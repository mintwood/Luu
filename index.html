<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>◯◯店 サービスアンケート</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
    .hidden { display: none; }
    .step { margin-top: 20px; }
    .button { margin-top: 10px; padding: 8px 16px; }
    .star-rating span { font-size: 24px; cursor: pointer; }
    .selected { color: gold; }
    textarea { width: 100%; height: 80px; }
  </style>
</head>
<body>
  <h1>◯◯店 サービスアンケート</h1>
  
  <!-- 初期UI：星評価、コメント欄、送信ボタン -->
  <div id="initialForm">
    <div class="star-rating" id="starRating">
      <!-- ★1〜5（クリックで評価） -->
      <span data-value="1">&#9733;</span>
      <span data-value="2">&#9733;</span>
      <span data-value="3">&#9733;</span>
      <span data-value="4">&#9733;</span>
      <span data-value="5">&#9733;</span>
    </div>
    <textarea id="comment" placeholder="ご意見・ご感想をお書きください"></textarea>
    <br>
    <button id="submitBtn" class="button">送信</button>
  </div>
  
  <!-- 低評価用ステップ -->
  <div id="lowRatingSteps" class="hidden">
    <div class="step">
      <label>【ステップ1】ご不満に思われた点をお聞かせください：</label><br>
      <textarea id="lowStep1"></textarea>
    </div>
    <div class="step">
      <label>【ステップ2】どのような改善があればよかったと感じられましたか？：</label><br>
      <textarea id="lowStep2"></textarea>
    </div>
    <div class="step">
      <label>【ステップ3】今回のようなことは以前にもありましたか？：</label><br>
      <select id="lowStep3">
        <option value="">選択してください</option>
        <option value="はい">はい</option>
        <option value="いいえ">いいえ</option>
      </select>
    </div>
    <div class="step">
      <label>【ステップ4】今後またご来店いただけますか？：</label><br>
      <select id="lowStep4">
        <option value="">選択してください</option>
        <option value="はい">はい</option>
        <option value="いいえ">いいえ</option>
      </select>
    </div>
    <div class="step">
      <p>ご感想ありがとうございました。<br>
         もしこの内容が、これからご来店を検討される方の参考になると感じられましたら、<br>
         「◯◯（店舗名）」とGoogleで検索いただくことで、投稿も可能です。<br>
         ※ご投稿はもちろん任意です。</p>
      <button id="lowGoogleBtn" class="button">Googleレビュー投稿画面へ</button>
    </div>
  </div>
  
  <!-- 高評価用ステップ -->
  <div id="highRatingSteps" class="hidden">
    <div id="displayedComment" class="step hidden">
      <p>【入力されたご感想】</p>
      <div id="copiedComment" style="border: 1px solid #ccc; padding: 10px;"></div>
      <button id="copyBtn" class="button">このコメントをコピー</button>
    </div>
    <div class="step">
      <p>ご感想ありがとうございました。<br>
         このコメントをGoogleレビューに投稿しますか？<br>
         ※ご投稿はもちろん任意です。</p>
      <button id="highYesBtn" class="button">はい、投稿する</button>
      <button id="highNoBtn" class="button">今回は投稿しない</button>
    </div>
    <div id="highThanks" class="step hidden">
      <p>ご回答ありがとうございました。</p>
    </div>
  </div>
  
  <script>
    let selectedRating = 0;
    const starElements = document.querySelectorAll('#starRating span');
    const commentEl = document.getElementById('comment');
    const submitBtn = document.getElementById('submitBtn');
    const lowRatingSteps = document.getElementById('lowRatingSteps');
    const highRatingSteps = document.getElementById('highRatingSteps');
    const displayedComment = document.getElementById('displayedComment');
    const copiedComment = document.getElementById('copiedComment');
    const copyBtn = document.getElementById('copyBtn');
    const highYesBtn = document.getElementById('highYesBtn');
    const highNoBtn = document.getElementById('highNoBtn');
    const highThanks = document.getElementById('highThanks');
    const lowGoogleBtn = document.getElementById('lowGoogleBtn');

    // 星評価クリック処理
    starElements.forEach(function(star) {
      star.addEventListener('click', function() {
        selectedRating = parseInt(this.getAttribute('data-value'));
        // 全ての星をリセット
        starElements.forEach(s => s.classList.remove('selected'));
        // 選択した評価までをハイライト
        for(let i = 0; i < selectedRating; i++){
          starElements[i].classList.add('selected');
        }
      });
    });

    // 送信ボタンのクリックイベント
    submitBtn.addEventListener('click', function() {
      if(selectedRating === 0) {
        alert("評価（★）を選択してください。");
        return;
      }
      // 初期フォームを非表示
      document.getElementById('initialForm').classList.add('hidden');
      
      if(selectedRating <= 2) {
        // 低評価の場合、低評価ステップを表示
        lowRatingSteps.classList.remove('hidden');
      } else {
        // 高評価の場合、入力コメントの有無で表示分岐
        const commentValue = commentEl.value.trim();
        if(commentValue !== ""){
          copiedComment.textContent = commentValue;
          displayedComment.classList.remove('hidden');
        }
        highRatingSteps.classList.remove('hidden');
      }
    });

    // 「このコメントをコピー」ボタン処理
    copyBtn.addEventListener('click', function() {
      const textToCopy = copiedComment.textContent;
      navigator.clipboard.writeText(textToCopy).then(function() {
        alert("コメントがコピーされました。");
      }, function(err) {
        alert("コピーに失敗しました。ブラウザの設定をご確認ください。");
      });
    });

    // 高評価「はい、投稿する」ボタン処理
    highYesBtn.addEventListener('click', function() {
      // Googleレビュー投稿画面への遷移（例：URLを指定）
      window.open("https://www.google.com/search?q=◯◯店舗+Googleレビュー", "_blank");
    });

    // 高評価「今回は投稿しない」ボタン処理
    highNoBtn.addEventListener('click', function() {
      highThanks.classList.remove('hidden');
    });

    // 低評価「Googleレビュー投稿画面へ」ボタン処理
    lowGoogleBtn.addEventListener('click', function() {
      window.open("https://www.google.com/search?q=◯◯店舗+Googleレビュー", "_blank");
    });
  </script>
</body>
</html>
